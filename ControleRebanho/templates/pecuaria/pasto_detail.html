{% extends "base.html" %}

{% block title %}Detalhes do Pasto: {{ pasto.nome }}{% endblock %}

{% block content %}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'pasto_list' %}">Controle de Pastos</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ pasto.nome }}</li>
    </ol>
</nav>

<h1 class="mb-4">{{ pasto.nome }}</h1>


<div class="card-body mb-4">
    <div class="d-flex gap-2">
        <a href="{% url 'pasto_update' pasto.id %}" class="btn btn-secondary">
            <i class="bi bi-calendar-event"></i> Alterar Dados
        </a>

    </div>
</div>

<div class="row g-3 mb-5">

    <div class="col-md-4">
        <div class="card h-100 border-info">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Capacidade Máxima (UA)</h6>
                <h5 class="card-title">{{ pasto.capacidade_maxima_ua }}</h5>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div
            class="card h-100 {% if pasto.get_total_animais > pasto.capacidade_maxima_ua %}border-danger{% else %}border-success{% endif %}">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Animais Atuais</h6>
                <h5 class="card-title">{{ pasto.get_total_animais }}</h5>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100 border-secondary">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Observações</h6>
                <p class="card-text">{{ pasto.observacoes|default:"Nenhuma observação." }}</p>
            </div>
        </div>
    </div>

</div>
<h3 class="mt-4">Lista de Animais no Pasto</h3>
<a href="{% url 'admin:ControleRebanho_movimentacaopasto_add' %}"
    class="btn btn-sm btn-outline-warning float-end">Movimentar Animal</a>

<table class="table table-striped table-hover mt-3">
    <thead class="table-dark">
        <tr>
            <th>Identificação</th>
            <th>Sexo</th>
            <th>Idade</th>
            <th>Últ. Peso (Kg)</th>
            <th>Situação</th>
        </tr>
    </thead>
    <tbody>
        {% for animal in animais_no_pasto %}
        <tr>
            <td><a href="{% url 'animal_detail' pk=animal.pk %}"><strong>{{ animal.identificacao }}</strong></a></td>
            <td>{{ animal.get_sexo_display }}</td>
            <td>{{ animal.data_nascimento|timesince|cut:" ago" }}</td>
            <td>
                {% with latest_pesagem=animal.pesagens.last %}
                {{ latest_pesagem.peso_kg|default:"-" }}
                {% endwith %}
            </td>
            <td><span class="badge bg-success">{{ animal.get_situacao_display }}</span></td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">Nenhum animal registrado neste pasto atualmente.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock content %}